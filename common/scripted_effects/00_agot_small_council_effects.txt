hire_small_councillor = {
	scope:recipient = {
		primary_title = {
			set_variable = {
				name = small_council_vassal_title
				value = scope:secondary_recipient.primary_title
			}
		}
	}
	scope:secondary_recipient = {
		add_character_flag = ai_should_not_transfer
		set_variable = {
			name = small_council_liege_title
			value = prev.primary_title
		}
		set_variable = {
			name = small_council_original_liege_title
			value = liege.primary_title
		}
		if = {
			limit = {
				NOT = {
					liege = prev
				}
			}
			create_title_and_vassal_change = {
				type = swear_fealty
				save_scope_as = change
			}
			change_liege = {
				liege = prev
				change = scope:change
			}
			resolve_title_and_vassal_change = scope:change
		}
		set_variable = small_council
		if = {
			limit = { vassal_contract_has_flag = has_no_contract }
			set_variable = special_contract_none
		}
		if = {
			limit = { vassal_contract_has_flag = has_scutage_contract }
			set_variable = special_contract_scutage
		}
		if = {
			limit = { vassal_contract_has_flag = has_march_contract }
			set_variable = special_contract_march
		}
		if = {
			limit = { vassal_contract_has_flag = has_palatinate_contract }
			set_variable = special_contract_palatinate
		}
		if = {
			limit = {
				has_government = lp_feudal_government
			}
			vassal_contract_set_obligation_level = {
				type = special_contract
				level = 4
			}
			set_vassal_contract_modification_blocked = yes
		}
	}
	if = {
		limit = { NOT = { has_relation_small_councillor = scope:secondary_recipient } }
		set_relation_small_councillor = scope:secondary_recipient
	}
}

agot_remove_repatriation_modifiers = {
	remove_character_modifier = small_council_vassal_low_tax_low_levies_modifier
	remove_character_modifier = small_council_vassal_low_tax_normal_levies_modifier
	remove_character_modifier = small_council_vassal_low_tax_high_levies_modifier
	remove_character_modifier = small_council_vassal_low_tax_extortionate_levies_modifier
	remove_character_modifier = small_council_vassal_normal_tax_low_levies_modifier
	remove_character_modifier = small_council_vassal_normal_tax_normal_levies_modifier
	remove_character_modifier = small_council_vassal_normal_tax_high_levies_modifier
	remove_character_modifier = small_council_vassal_normal_tax_extortionate_levies_modifier
	remove_character_modifier = small_council_vassal_high_tax_low_levies_modifier
	remove_character_modifier = small_council_vassal_high_tax_normal_levies_modifier
	remove_character_modifier = small_council_vassal_high_tax_high_levies_modifier
	remove_character_modifier = small_council_vassal_high_tax_extortionate_levies_modifier
	remove_character_modifier = small_council_vassal_extortionate_tax_low_levies_modifier
	remove_character_modifier = small_council_vassal_extortionate_tax_normal_levies_modifier
	remove_character_modifier = small_council_vassal_extortionate_tax_high_levies_modifier
	remove_character_modifier = small_council_vassal_extortionate_tax_extortionate_levies_modifier
}

agot_reassign_repatriation_modifier = {
	$OLD_LIEGE$ = { save_scope_as = old_liege }
	$NEW_LIEGE$ = { save_scope_as = new_liege }
	if = {
		limit = {
			scope:old_liege = { has_character_modifier = small_council_vassal_low_tax_low_levies_modifier }
		}
		scope:old_liege = {
			remove_character_modifier = small_council_vassal_low_tax_low_levies_modifier
		}
		scope:new_liege = {
			add_character_modifier = small_council_vassal_low_tax_low_levies_modifier
		}
	}
	if = {
		limit = {
			scope:old_liege = { has_character_modifier = small_council_vassal_low_tax_normal_levies_modifier }
		}
		scope:old_liege = {
			remove_character_modifier = small_council_vassal_low_tax_normal_levies_modifier
		}
		scope:new_liege = {
			add_character_modifier = small_council_vassal_low_tax_normal_levies_modifier
		}
	}
	if = {
		limit = {
			scope:old_liege = { has_character_modifier = small_council_vassal_low_tax_high_levies_modifier }
		}
		scope:old_liege = {
			remove_character_modifier = small_council_vassal_low_tax_high_levies_modifier
		}
		scope:new_liege = {
			add_character_modifier = small_council_vassal_low_tax_high_levies_modifier
		}
	}
	if = {
		limit = {
			scope:old_liege = { has_character_modifier = small_council_vassal_low_tax_extortionate_levies_modifier }
		}
		scope:old_liege = {
			remove_character_modifier = small_council_vassal_low_tax_extortionate_levies_modifier
		}
		scope:new_liege = {
			add_character_modifier = small_council_vassal_low_tax_extortionate_levies_modifier
		}
	}
	if = {
		limit = {
			scope:old_liege = { has_character_modifier = small_council_vassal_normal_tax_low_levies_modifier }
		}
		scope:old_liege = {
			remove_character_modifier = small_council_vassal_normal_tax_low_levies_modifier
		}
		scope:new_liege = {
			add_character_modifier = small_council_vassal_normal_tax_low_levies_modifier
		}
	}
	if = {
		limit = {
			scope:old_liege = { has_character_modifier = small_council_vassal_normal_tax_normal_levies_modifier }
		}
		scope:old_liege = {
			remove_character_modifier = small_council_vassal_normal_tax_normal_levies_modifier
		}
		scope:new_liege = {
			add_character_modifier = small_council_vassal_normal_tax_normal_levies_modifier
		}
	}
	if = {
		limit = {
			scope:old_liege = { has_character_modifier = small_council_vassal_normal_tax_high_levies_modifier }
		}
		scope:old_liege = {
			remove_character_modifier = small_council_vassal_normal_tax_high_levies_modifier
		}
		scope:new_liege = {
			add_character_modifier = small_council_vassal_normal_tax_high_levies_modifier
		}
	}
	if = {
		limit = {
			scope:old_liege = { has_character_modifier = small_council_vassal_normal_tax_extortionate_levies_modifier }
		}
		scope:old_liege = {
			remove_character_modifier = small_council_vassal_normal_tax_extortionate_levies_modifier
		}
		scope:new_liege = {
			add_character_modifier = small_council_vassal_normal_tax_extortionate_levies_modifier
		}
	}
	if = {
		limit = {
			scope:old_liege = { has_character_modifier = small_council_vassal_high_tax_low_levies_modifier }
		}
		scope:old_liege = {
			remove_character_modifier = small_council_vassal_high_tax_low_levies_modifier
		}
		scope:new_liege = {
			add_character_modifier = small_council_vassal_high_tax_low_levies_modifier
		}
	}
	if = {
		limit = {
			scope:old_liege = { has_character_modifier = small_council_vassal_high_tax_normal_levies_modifier }
		}
		scope:old_liege = {
			remove_character_modifier = small_council_vassal_high_tax_normal_levies_modifier
		}
		scope:new_liege = {
			add_character_modifier = small_council_vassal_high_tax_normal_levies_modifier
		}
	}
	if = {
		limit = {
			scope:old_liege = { has_character_modifier = small_council_vassal_high_tax_high_levies_modifier }
		}
		scope:old_liege = {
			remove_character_modifier = small_council_vassal_high_tax_high_levies_modifier
		}
		scope:new_liege = {
			add_character_modifier = small_council_vassal_high_tax_high_levies_modifier
		}
	}
	if = {
		limit = {
			scope:old_liege = { has_character_modifier = small_council_vassal_high_tax_extortionate_levies_modifier }
		}
		scope:old_liege = {
			remove_character_modifier = small_council_vassal_high_tax_extortionate_levies_modifier
		}
		scope:new_liege = {
			add_character_modifier = small_council_vassal_high_tax_extortionate_levies_modifier
		}
	}
	if = {
		limit = {
			scope:old_liege = { has_character_modifier = small_council_vassal_extortionate_tax_low_levies_modifier }
		}
		scope:old_liege = {
			remove_character_modifier = small_council_vassal_extortionate_tax_low_levies_modifier
		}
		scope:new_liege = {
			add_character_modifier = small_council_vassal_extortionate_tax_low_levies_modifier
		}
	}
	if = {
		limit = {
			scope:old_liege = { has_character_modifier = small_council_vassal_extortionate_tax_normal_levies_modifier }
		}
		scope:old_liege = {
			remove_character_modifier = small_council_vassal_extortionate_tax_normal_levies_modifier
		}
		scope:new_liege = {
			add_character_modifier = small_council_vassal_extortionate_tax_normal_levies_modifier
		}
	}
	if = {
		limit = {
			scope:old_liege = { has_character_modifier = small_council_vassal_extortionate_tax_high_levies_modifier }
		}
		scope:old_liege = {
			remove_character_modifier = small_council_vassal_extortionate_tax_high_levies_modifier
		}
		scope:new_liege = {
			add_character_modifier = small_council_vassal_extortionate_tax_high_levies_modifier
		}
	}
	if = {
		limit = {
			scope:old_liege = { has_character_modifier = small_council_vassal_extortionate_tax_extortionate_levies_modifier }
		}
		scope:old_liege = {
			remove_character_modifier = small_council_vassal_extortionate_tax_extortionate_levies_modifier
		}
		scope:new_liege = {
			add_character_modifier = small_council_vassal_extortionate_tax_extortionate_levies_modifier
		}
	}
}

fire_small_councillor = {
	hidden_effect = {
		liege = { remove_relation_small_councillor = prev }
	}
	if = {
		limit = {
			exists = var:small_council_original_liege_title.holder
			var:small_council_original_liege_title.holder.highest_held_title_tier > highest_held_title_tier
		}
		create_title_and_vassal_change = {
			type = swear_fealty
			save_scope_as = change
		}
		change_liege = {
			liege = var:small_council_original_liege_title.holder
			change = scope:change
		}
		resolve_title_and_vassal_change = scope:change
		hidden_effect = {
			var:small_council_original_liege_title ?= {
				remove_variable = small_council_vassal_title
			}
			if = {
				limit = { has_variable = special_contract_none }
				vassal_contract_set_obligation_level = { type = special_contract level = 0 }
			}
			if = {
				limit = { has_variable = special_contract_scutage }
				vassal_contract_set_obligation_level = { type = special_contract level = 1 }
			}
			if = {
				limit = { has_variable = special_contract_march }
				vassal_contract_set_obligation_level = { type = special_contract level = 2 }
			}
			if = {
				limit = { has_variable = special_contract_palatinate }
				vassal_contract_set_obligation_level = { type = special_contract level = 3 }
			}
			var:small_council_original_liege_title.holder = {
				agot_remove_repatriation_modifiers = yes
			}
		}
	}
	hidden_effect = {
		remove_variable = small_council
		remove_variable = small_council_liege_title
		remove_variable = small_council_original_liege_title
		remove_localized_text = small_council_title
		remove_character_flag = ai_should_not_transfer
	}
}

small_councillor_appointment_effect = {
	if = {
		limit = {
			scope:secondary_recipient = {
				has_variable = castellan
			}
		}
		if = {
			limit = { exists = cp:councillor_castellan }
			fire_councillor = cp:councillor_castellan
		}
		root = {
			assign_councillor_type = {
			type = councillor_castellan
			target = scope:secondary_recipient
			}
		}
		scope:secondary_recipient = {
			remove_variable = castellan
		}
	}
	if = {
		limit = {
			scope:secondary_recipient = {
				has_variable = chancellor
			}
		}
		if = {
			limit = { exists = cp:councillor_chancellor }
			fire_councillor = cp:councillor_chancellor
		}
		root = {
			assign_councillor_type = {
			type = councillor_chancellor
			target = scope:secondary_recipient
			}
		}
		scope:secondary_recipient = {
			remove_variable = chancellor
		}
	}
	if = {
		limit = {
			scope:secondary_recipient = {
				has_variable = steward
			}
		}
		if = {
			limit = { exists = cp:councillor_steward }
			fire_councillor = cp:councillor_steward
		}
		root = {
			assign_councillor_type = {
			type = councillor_steward
			target = scope:secondary_recipient
			}
		}
		scope:secondary_recipient = {
			remove_variable = steward
		}
	}
	if = {
		limit = {
			scope:secondary_recipient = {
				has_variable = marshal
			}
		}
		if = {
			limit = { exists = cp:councillor_marshal }
			fire_councillor = cp:councillor_marshal
		}
		root = {
			assign_councillor_type = {
			type = councillor_marshal
			target = scope:secondary_recipient
			}
		}
		scope:secondary_recipient = {
			remove_variable = marshal
		}
	}
	if = {
		limit = {
			scope:secondary_recipient = {
				has_variable = admiral
			}
		}
		fire_councillor = cp:councillor_admiral
		root = {
			assign_councillor_type = {
			type = councillor_admiral
			target = scope:secondary_recipient
			}
		}
		scope:secondary_recipient = {
			remove_variable = admiral
		}
	}
	if = {
		limit = {
			scope:secondary_recipient = {
				has_variable = spymaster
			}
		}
		if = {
			limit = { exists = cp:councillor_spymaster }
			fire_councillor = cp:councillor_spymaster
		}
		root = {
			assign_councillor_type = {
			type = councillor_spymaster
			target = scope:secondary_recipient
			}
		}
		scope:secondary_recipient = {
			remove_variable = spymaster
		}
	}
}

small_councillor_vassal_repatriation_effect = {
	if = {
		limit = {
			scope:secondary_recipient = {
				vassal_contract_obligation_level:feudal_government_taxes = feudal_tax_low_level
				vassal_contract_obligation_level:feudal_government_levies = feudal_levies_low_level
			}
		}
		add_character_modifier = {
			modifier = small_council_vassal_low_tax_low_levies_modifier
		}
	}
	else_if = {
		limit = {
			scope:secondary_recipient = {
				vassal_contract_obligation_level:feudal_government_taxes = feudal_tax_low_level
				vassal_contract_obligation_level:feudal_government_levies = feudal_levies_normal_level
			}
		}
		add_character_modifier = {
			modifier = small_council_vassal_low_tax_normal_levies_modifier
		}
	}
	else_if = {
		limit = {
			scope:secondary_recipient = {
				vassal_contract_obligation_level:feudal_government_taxes = feudal_tax_low_level
				vassal_contract_obligation_level:feudal_government_levies = feudal_levies_high_level
			}
		}
		add_character_modifier = {
			modifier = small_council_vassal_low_tax_high_levies_modifier
		}
	}
	else_if = {
		limit = {
			scope:secondary_recipient = {
				vassal_contract_obligation_level:feudal_government_taxes = feudal_tax_low_level
				vassal_contract_obligation_level:feudal_government_levies = feudal_levies_extortionate_level
			}
		}
		add_character_modifier = {
			modifier = small_council_vassal_low_tax_extortionate_levies_modifier
		}
	}
	else_if = {
		limit = {
			scope:secondary_recipient = {
				vassal_contract_obligation_level:feudal_government_taxes = feudal_tax_normal_level
				vassal_contract_obligation_level:feudal_government_levies = feudal_levies_low_level
			}
		}
		add_character_modifier = {
			modifier = small_council_vassal_normal_tax_low_levies_modifier
		}
	}
	else_if = {
		limit = {
			scope:secondary_recipient = {
				vassal_contract_obligation_level:feudal_government_taxes = feudal_tax_normal_level
				vassal_contract_obligation_level:feudal_government_levies = feudal_levies_normal_level
			}
		}
		add_character_modifier = {
			modifier = small_council_vassal_normal_tax_normal_levies_modifier
		}
	}
	else_if = {
		limit = {
			scope:secondary_recipient = {
				vassal_contract_obligation_level:feudal_government_taxes = feudal_tax_normal_level
				vassal_contract_obligation_level:feudal_government_levies = feudal_levies_high_level
			}
		}
		add_character_modifier = {
			modifier = small_council_vassal_normal_tax_high_levies_modifier
		}
	}
	else_if = {
		limit = {
			scope:secondary_recipient = {
				vassal_contract_obligation_level:feudal_government_taxes = feudal_tax_normal_level
				vassal_contract_obligation_level:feudal_government_levies = feudal_levies_extortionate_level
			}
		}
		add_character_modifier = {
			modifier = small_council_vassal_normal_tax_extortionate_levies_modifier
		}
	}
	else_if = {
		limit = {
			scope:secondary_recipient = {
				vassal_contract_obligation_level:feudal_government_taxes = feudal_tax_high_level
				vassal_contract_obligation_level:feudal_government_levies = feudal_levies_low_level
			}
		}
		add_character_modifier = {
			modifier = small_council_vassal_high_tax_low_levies_modifier
		}
	}
	else_if = {
		limit = {
			scope:secondary_recipient = {
				vassal_contract_obligation_level:feudal_government_taxes = feudal_tax_high_level
				vassal_contract_obligation_level:feudal_government_levies = feudal_levies_normal_level
			}
		}
		add_character_modifier = {
			modifier = small_council_vassal_high_tax_normal_levies_modifier
		}
	}
	else_if = {
		limit = {
			scope:secondary_recipient = {
				vassal_contract_obligation_level:feudal_government_taxes = feudal_tax_high_level
				vassal_contract_obligation_level:feudal_government_levies = feudal_levies_high_level
			}
		}
		add_character_modifier = {
			modifier = small_council_vassal_high_tax_high_levies_modifier
		}
	}
	else_if = {
		limit = {
			scope:secondary_recipient = {
				vassal_contract_obligation_level:feudal_government_taxes = feudal_tax_high_level
				vassal_contract_obligation_level:feudal_government_levies = feudal_levies_extortionate_level
			}
		}
		add_character_modifier = {
			modifier = small_council_vassal_high_tax_extortionate_levies_modifier
		}
	}
	else_if = {
		limit = {
			scope:secondary_recipient = {
				vassal_contract_obligation_level:feudal_government_taxes = feudal_tax_extortionate_level
				vassal_contract_obligation_level:feudal_government_levies = feudal_levies_low_level
			}
		}
		add_character_modifier = {
			modifier = small_council_vassal_extortionate_tax_low_levies_modifier
		}
	}
	else_if = {
		limit = {
			scope:secondary_recipient = {
				vassal_contract_obligation_level:feudal_government_taxes = feudal_tax_extortionate_level
				vassal_contract_obligation_level:feudal_government_levies = feudal_levies_normal_level
			}
		}
		add_character_modifier = {
			modifier = small_council_vassal_extortionate_tax_normal_levies_modifier
		}
	}
	else_if = {
		limit = {
			scope:secondary_recipient = {
				vassal_contract_obligation_level:feudal_government_taxes = feudal_tax_extortionate_level
				vassal_contract_obligation_level:feudal_government_levies = feudal_levies_high_level
			}
		}
		add_character_modifier = {
			modifier = small_council_vassal_extortionate_tax_high_levies_modifier
		}
	}
	else_if = {
		limit = {
			scope:secondary_recipient = {
				vassal_contract_obligation_level:feudal_government_taxes = feudal_tax_extortionate_level
				vassal_contract_obligation_level:feudal_government_levies = feudal_levies_extortionate_level
			}
		}
		add_character_modifier = {
			modifier = small_council_vassal_extortionate_tax_extortionate_levies_modifier
		}
	}
}
