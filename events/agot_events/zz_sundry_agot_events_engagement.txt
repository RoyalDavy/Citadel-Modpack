namespace = agot_engagement_events

#todo add elope events to check for scheme scope

scripted_trigger agot_engagement_negative_opinion_refusal = {
	$BETROTHED_1$ = { save_temporary_scope_as = betrothed_1_temp }
	$BETROTHED_2$ = { save_temporary_scope_as = betrothed_2_temp }
	exists = scope:betrothed_1_temp
	exists = scope:betrothed_2_temp

	scope:betrothed_1_temp = {
		OR = {
			opinion = {
				target = scope:betrothed_2_temp
				value <= -80
			}
			has_relation_rival = scope:betrothed_2_temp
		}
	}
}

scripted_trigger agot_engagement_negative_opinion_flavor = {
	$BETROTHED_1$ = { save_temporary_scope_as = betrothed_1_temp }
	$BETROTHED_2$ = { save_temporary_scope_as = betrothed_2_temp }
	exists = scope:betrothed_1_temp
	exists = scope:betrothed_2_temp

	scope:betrothed_1_temp = {
		OR = {
			opinion = {
				target = scope:betrothed_2_temp
				value <= 20
			}
			has_relation_rival = scope:betrothed_2_temp
		}
	}
}

scripted_trigger agot_engagement_bastard = {
	$BETROTHED_1$ = { save_temporary_scope_as = betrothed_1_temp }
	$BETROTHED_2$ = { save_temporary_scope_as = betrothed_2_temp }
	exists = scope:betrothed_1_temp
	exists = scope:betrothed_2_temp

	scope:betrothed_1_temp = {
		NOR = {
			has_trait = bastard
			has_trait = legitimized_bastard
		}
		religion = religion:faith_of_the_seven_religion
	}
	scope:betrothed_2_temp = {
		OR = {
			has_trait = bastard
			AND = {
				has_trait = legitimized_bastard
				is_ruler = no
			}
		}
	}
}

scripted_trigger agot_engagement_lowborn = {
	$BETROTHED_1$ = { save_temporary_scope_as = betrothed_1_temp }
	$BETROTHED_2$ = { save_temporary_scope_as = betrothed_2_temp }
	exists = scope:betrothed_1_temp
	exists = scope:betrothed_2_temp

	scope:betrothed_1_temp = { is_lowborn = no }
	scope:betrothed_2_temp = { is_lowborn = yes }
}

scripted_trigger agot_engagement_not_attracted_to_me = {
	$BETROTHED_1$ = { save_temporary_scope_as = betrothed_1_temp }
	$BETROTHED_2$ = { save_temporary_scope_as = betrothed_2_temp }
	exists = scope:betrothed_1_temp
	exists = scope:betrothed_2_temp

	scope:betrothed_2_temp = {
		age > 10
		NOT = { is_attracted_to_gender_of = scope:betrothed_1_temp }
	}
}

scripted_trigger agot_engagement_not_attracted_to_them = {
	$BETROTHED_1$ = { save_temporary_scope_as = betrothed_1_temp }
	$BETROTHED_2$ = { save_temporary_scope_as = betrothed_2_temp }
	exists = scope:betrothed_1_temp
	exists = scope:betrothed_2_temp

	scope:betrothed_1_temp = {
		age > 10
		NOT = { is_attracted_to_gender_of = scope:betrothed_2_temp }
	}
}

scripted_trigger agot_engagement_unfaithful = {
	$BETROTHED_1$ = { save_temporary_scope_as = betrothed_1_temp }
	$BETROTHED_2$ = { save_temporary_scope_as = betrothed_2_temp }
	exists = scope:betrothed_1_temp
	exists = scope:betrothed_2_temp

	scope:betrothed_1_temp = {
		NOR = {
			has_trait = lustful
			has_trait = rakish
			has_trait = adulterer
			has_trait = fornicator
			any_child = {
				even_if_dead = yes
				OR = {
					has_trait = bastard
					has_trait = legitimized_bastard
				}
			}
		}
	}

	scope:betrothed_2_temp = {
		OR = {
			has_trait = lustful
			has_trait = rakish
			has_trait = adulterer
			has_trait = fornicator
			any_child = {
				even_if_dead = yes
				OR = {
					has_trait = bastard
					has_trait = legitimized_bastard
				}
			}
		}
	}
}

scripted_trigger agot_engagement_prude = {
	$BETROTHED_1$ = { save_temporary_scope_as = betrothed_1_temp }
	$BETROTHED_2$ = { save_temporary_scope_as = betrothed_2_temp }
	exists = scope:betrothed_1_temp
	exists = scope:betrothed_2_temp

	scope:betrothed_1_temp = { has_trait = lustful }
	scope:betrothed_2_temp = { has_trait = chaste }
}

scripted_trigger agot_engagement_unkind = {
	$BETROTHED_1$ = { save_temporary_scope_as = betrothed_1_temp }
	$BETROTHED_2$ = { save_temporary_scope_as = betrothed_2_temp }
	exists = scope:betrothed_1_temp
	exists = scope:betrothed_2_temp

	scope:betrothed_1_temp = {
		OR = {
			has_trait = compassionate
			ai_compassion > medium_positive_compassion
		}
	}
	scope:betrothed_2_temp = {
		OR = {
			has_trait = sadistic
			has_trait = callous
			has_trait = torturer
			has_trait = murderer
			has_trait = kinslayer_1
			has_trait = kinslayer_2
			has_trait = kinslayer_3
		}
	}
}

scripted_trigger agot_engagement_too_young = {
	$BETROTHED_1$ = { save_temporary_scope_as = betrothed_1_temp }
	$BETROTHED_2$ = { save_temporary_scope_as = betrothed_2_temp }
	exists = scope:betrothed_1_temp
	exists = scope:betrothed_2_temp

	scope:betrothed_1_temp.age > scope:betrothed_2_temp.age
	trigger_if = {
		limit = { scope:betrothed_1_temp.age > 25 }
		scope:betrothed_2_temp.age < 12
	}
	trigger_else_if = {
		limit = { scope:betrothed_1_temp.age > 20 }
		scope:betrothed_2_temp.age < 10
	}
	trigger_else_if = {
		limit = { scope:betrothed_1_temp.age > 14 }
		scope:betrothed_2_temp.age < 6
	}
	trigger_else = {
		always = no
	}
}

scripted_trigger agot_engagement_too_old = {
	$BETROTHED_1$ = { save_temporary_scope_as = betrothed_1_temp }
	$BETROTHED_2$ = { save_temporary_scope_as = betrothed_2_temp }
	exists = scope:betrothed_1_temp
	exists = scope:betrothed_2_temp

	scope:betrothed_2_temp.age > scope:betrothed_1_temp.age
	trigger_if = {
		limit = { scope:betrothed_1_temp.age > 50 }
		always = no
	}
	trigger_else_if = {
		limit = { scope:betrothed_1_temp.age > 45 }
		scope:betrothed_2_temp.age > 75
	}
	trigger_else_if = {
		limit = { scope:betrothed_1_temp.age > 40 }
		scope:betrothed_2_temp.age > 70
	}
	trigger_else_if = {
		limit = { scope:betrothed_1_temp.age > 35 }
		scope:betrothed_2_temp.age > 55
	}
	trigger_else_if = {
		limit = { scope:betrothed_1_temp.age > 25 }
		scope:betrothed_2_temp.age > 45
	}
	trigger_else_if = {
		limit = { scope:betrothed_1_temp.age > 20 }
		scope:betrothed_2_temp.age > 40
	}
	trigger_else_if = {
		limit = { scope:betrothed_1_temp.age > 15 }
		scope:betrothed_2_temp.age > 35
	}
	trigger_else = {
		scope:betrothed_2_temp.age > 30
	}
}

scripted_trigger agot_engagement_has_lover = {
	$BETROTHED_1$ = { save_temporary_scope_as = betrothed_1_temp }
	$BETROTHED_2$ = { save_temporary_scope_as = betrothed_2_temp }
	exists = scope:betrothed_1_temp
	exists = scope:betrothed_2_temp

	scope:betrothed_1_temp = {
		NOT = { has_relation_lover = scope:betrothed_2_temp }
		OR = {
			any_relation = {
				type = lover
				exists = this
			}
			any_relation = {
				type = soulmate
				exists = this
			}
		}
	}
}

scripted_trigger agot_engagement_deformed = {
	$BETROTHED_1$ = { save_temporary_scope_as = betrothed_1_temp }
	$BETROTHED_2$ = { save_temporary_scope_as = betrothed_2_temp }
	exists = scope:betrothed_1_temp
	exists = scope:betrothed_2_temp

	scope:betrothed_1_temp = {
		NOR = {
			has_trait = compassionate
			ai_compassion > medium_positive_compassion
		}
	}
	scope:betrothed_2_temp = {
		OR = {
			has_trait = beauty_bad
			has_trait = dwarf
			has_trait = crippled
			has_trait = disfigured
		}
	}
}

scripted_trigger agot_unhappy_engagement = {
	$BETROTHED_1$ = { save_temporary_scope_as = betrothed_1_temp }
	$BETROTHED_2$ = { save_temporary_scope_as = betrothed_2_temp }
	exists = scope:betrothed_1_temp
	exists = scope:betrothed_2_temp

	OR = {
		agot_engagement_negative_opinion_refusal = { BETROTHED_1 = scope:betrothed_1_temp BETROTHED_2 = scope:betrothed_2_temp }
		agot_engagement_lowborn = { BETROTHED_1 = scope:betrothed_1_temp BETROTHED_2 = scope:betrothed_2_temp }
		agot_engagement_bastard = { BETROTHED_1 = scope:betrothed_1_temp BETROTHED_2 = scope:betrothed_2_temp }
		agot_engagement_not_attracted_to_me = { BETROTHED_1 = scope:betrothed_1_temp BETROTHED_2 = scope:betrothed_2_temp }
		agot_engagement_not_attracted_to_them = { BETROTHED_1 = scope:betrothed_1_temp BETROTHED_2 = scope:betrothed_2_temp }
		agot_engagement_unfaithful = { BETROTHED_1 = scope:betrothed_1_temp BETROTHED_2 = scope:betrothed_2_temp }
		agot_engagement_unkind = { BETROTHED_1 = scope:betrothed_1_temp BETROTHED_2 = scope:betrothed_2_temp }
		agot_engagement_too_young = { BETROTHED_1 = scope:betrothed_1_temp BETROTHED_2 = scope:betrothed_2_temp }
		agot_engagement_too_old = { BETROTHED_1 = scope:betrothed_1_temp BETROTHED_2 = scope:betrothed_2_temp }
		agot_engagement_has_lover = { BETROTHED_1 = scope:betrothed_1_temp BETROTHED_2 = scope:betrothed_2_temp }
		agot_engagement_deformed = { BETROTHED_1 = scope:betrothed_1_temp BETROTHED_2 = scope:betrothed_2_temp }
	}
}

agot_engagement_events.0001 = {
	hidden = yes

	trigger = {
		exists = betrothed
		NAND = {
			has_variable = unhappy_with_fiance
			var:unhappy_with_fiance = betrothed
		}
		age > 14

		OR = {
			any_player = {
				NOT = { this = root }
				NOT = { has_trait = nightswatch }
				dynasty ?= root.dynasty
				OR = {
					is_parent_of = root
					is_grandparent_of = root
					is_great_grandparent_of = root
				}
			}
			any_player = {
				NOT = { this = root.betrothed }
				NOT = { has_trait = nightswatch }
				dynasty ?= root.betrothed.dynasty
				OR = {
					is_parent_of = root.betrothed
					is_grandparent_of = root.betrothed
					is_great_grandparent_of = root.betrothed
				}
			}
		}
		agot_unhappy_engagement = { BETROTHED_1 = root BETROTHED_2 = betrothed }
	}

	immediate = {
		save_scope_as = betrothed_1
		betrothed = { save_scope_as = betrothed_2 }

		if = {
			limit = { any_player = { count > 1 } }
			#i hate multiplayer
		}
		else_if = {
			limit = {
				any_player = {
					NOT = { this = root }
					dynasty ?= root.dynasty
					OR = {
						is_parent_of = root
						is_grandparent_of = root
						is_great_grandparent_of = root
					}
				}
			}
			random_player = {
				limit = {
					dynasty ?= root.dynasty
					OR = {
						is_parent_of = root
						is_grandparent_of = root
						is_great_grandparent_of = root
					}
				}
				save_scope_as = betrothed_1_arbiter
			}

			scope:betrothed_1 = { save_scope_as = actor }
			scope:betrothed_2 = { save_scope_as = opinion_target }

			scope:betrothed_1_arbiter ?= {
				random = {
					chance = {
						value = 0

						if = {
							limit = {
								scope:betrothed_1 = {
									opinion = {
										target = scope:betrothed_2
										value < 0
									}
								}
							}
							add = {
								value = calc_actor_rough_opinion_target_opinion_value
								multiply = -1
							}
						}

						add = scope:betrothed_1.ai_boldness

						subtract = scope:betrothed_1.ai_rationality

						if = {
							limit = {
								scope:betrothed_1 = { has_trait = stubborn }
							}
							add = 25
						}

						if = {
							limit = {
								scope:betrothed_1 = { agot_engagement_lowborn = { BETROTHED_1 = scope:betrothed_1 BETROTHED_2 = scope:betrothed_2 } }
							}
							add = 50
						}
						if = {
							limit = {
								scope:betrothed_1 = { agot_engagement_bastard = { BETROTHED_1 = scope:betrothed_1 BETROTHED_2 = scope:betrothed_2 } }
							}
							add = 25
						}
						if = {
							limit = {
								scope:betrothed_1 = { agot_engagement_not_attracted_to_me = { BETROTHED_1 = scope:betrothed_1 BETROTHED_2 = scope:betrothed_2 } }
							}
							add = 25
						}
						if = {
							limit = {
								scope:betrothed_1 = { agot_engagement_not_attracted_to_me = { BETROTHED_1 = scope:betrothed_1 BETROTHED_2 = scope:betrothed_2 } }
							}
							add = 25
						}
						if = {
							limit = {
								scope:betrothed_1 = { agot_engagement_unfaithful = { BETROTHED_1 = scope:betrothed_1 BETROTHED_2 = scope:betrothed_2 } }
							}
							add = 25
						}
						if = {
							limit = {
								scope:betrothed_1 = { agot_engagement_unkind = { BETROTHED_1 = scope:betrothed_1 BETROTHED_2 = scope:betrothed_2 } }
							}
							add = 25
						}
						if = {
							limit = {
								scope:betrothed_1 = { agot_engagement_too_young = { BETROTHED_1 = scope:betrothed_1 BETROTHED_2 = scope:betrothed_2 } }
							}
							add = 25
						}
						if = {
							limit = {
								scope:betrothed_1 = { agot_engagement_too_old = { BETROTHED_1 = scope:betrothed_1 BETROTHED_2 = scope:betrothed_2 } }
							}
							add = 25
						}
						if = {
							limit = {
								scope:betrothed_1 = { agot_engagement_has_lover = { BETROTHED_1 = scope:betrothed_1 BETROTHED_2 = scope:betrothed_2 } }
							}
							add = 25
						}
						if = {
							limit = {
								scope:betrothed_1 = { agot_engagement_deformed = { BETROTHED_1 = scope:betrothed_1 BETROTHED_2 = scope:betrothed_2 } }
							}
							add = 25
						}
						if = {
							limit = {
								scope:betrothed_1 = { has_relation_crush = scope:betrothed_2 }
							}
							multiply = 0
						}
					}
					if = {
						limit = { scope:betrothed_1_arbiter = scope:betrothed_2 }
						trigger_event = {
							id = agot_engagement_events.0003
							days = { 3 7 }
						}
					}
					else = {
						trigger_event = agot_engagement_events.0002
					}
				}
			}
		}
		else = {
			scope:betrothed_2 = {
				trigger_event = {
					id = agot_engagement_events.0001
					days = { 10 60 }
				}
			}
		}
	}
}

agot_engagement_events.0002 = {
	type = character_event
	title = agot_engagement_events.0002.t
	desc = {
		desc = agot_engagement_events.0002.desc.intro
		triggered_desc = {
			trigger = { scope:betrothed_1 = { agot_engagement_negative_opinion_flavor = { BETROTHED_1 = scope:betrothed_1 BETROTHED_2 = scope:betrothed_2 } } }
			desc = agot_engagement_events.0002.desc.negative_opinion
		}
		triggered_desc = {
			trigger = { scope:betrothed_1 = { agot_engagement_lowborn = { BETROTHED_1 = scope:betrothed_1 BETROTHED_2 = scope:betrothed_2 } } }
			desc = agot_engagement_events.0002.desc.lowborn
		}
		triggered_desc = {
			trigger = { scope:betrothed_1 = { agot_engagement_not_attracted_to_me = { BETROTHED_1 = scope:betrothed_1 BETROTHED_2 = scope:betrothed_2 } } }
			desc = agot_engagement_events.0002.desc.not_attracted_to_me
		}
		triggered_desc = {
			trigger = { scope:betrothed_1 = { agot_engagement_not_attracted_to_them = { BETROTHED_1 = scope:betrothed_1 BETROTHED_2 = scope:betrothed_2 } } }
			desc = agot_engagement_events.0002.desc.not_attracted_to_them
		}
		triggered_desc = {
			trigger = { scope:betrothed_1 = { agot_engagement_deformed = { BETROTHED_1 = scope:betrothed_1 BETROTHED_2 = scope:betrothed_2 } } }
			desc = agot_engagement_events.0002.desc.deformed
		}
		triggered_desc = {
			trigger = { scope:betrothed_1 = { agot_engagement_unfaithful = { BETROTHED_1 = scope:betrothed_1 BETROTHED_2 = scope:betrothed_2 } } }
			desc = agot_engagement_events.0002.desc.unfaithful
		}
		triggered_desc = {
			trigger = { scope:betrothed_1 = { agot_engagement_prude = { BETROTHED_1 = scope:betrothed_1 BETROTHED_2 = scope:betrothed_2 } } }
			desc = agot_engagement_events.0002.desc.prude
		}
		triggered_desc = {
			trigger = { scope:betrothed_1 = { agot_engagement_unkind = { BETROTHED_1 = scope:betrothed_1 BETROTHED_2 = scope:betrothed_2 } } }
			desc = agot_engagement_events.0002.desc.unkind
		}
		triggered_desc = {
			trigger = { scope:betrothed_1 = { agot_engagement_too_young = { BETROTHED_1 = scope:betrothed_1 BETROTHED_2 = scope:betrothed_2 } } }
			desc = agot_engagement_events.0002.desc.too_young
		}
		triggered_desc = {
			trigger = { scope:betrothed_1 = { agot_engagement_too_old = { BETROTHED_1 = scope:betrothed_1 BETROTHED_2 = scope:betrothed_2 } } }
			desc = agot_engagement_events.0002.desc.too_old
		}
		triggered_desc = {
			trigger = { scope:betrothed_1 = { agot_engagement_has_lover = { BETROTHED_1 = scope:betrothed_1 BETROTHED_2 = scope:betrothed_2 } } }
			desc = agot_engagement_events.0002.desc.has_lover
		}
		triggered_desc = {
			trigger = { scope:betrothed_1 = { agot_engagement_bastard = { BETROTHED_1 = scope:betrothed_1 BETROTHED_2 = scope:betrothed_2 } } }
			desc = agot_engagement_events.0002.desc.bastard
		}
		desc = agot_engagement_events.0002.desc.outro
	}

	theme = family

	left_portrait = {
		character = scope:betrothed_1
		animation = anger
	}

	right_portrait = {
		character = root
		animation = thinking
	}


	immediate = {
		if = {
			limit = { agot_engagement_has_lover = { BETROTHED_1 = scope:betrothed_1 BETROTHED_2 = scope:betrothed_2 } }
			random_relation = {
				type = lover
				limit = { is_ai = no }
				save_scope_as = betrothed_lover
			}
			random_relation = {
				type = soulmate
				limit = { is_ai = no }
				save_scope_as = betrothed_lover
			}
		}
	}

	#Force them to go through with the engagement
	option = {
		name = agot_engagement_events.0002.a
		custom_tooltip = agot_engagement_events.0002.a.tt

		scope:betrothed_1 = {
			add_opinion = {
				target = root
				opinion = -60
				modifier = disappointed_opinion
			}
		}

		hidden_effect = {
			random_list = {
				#nothing happens
				15 = {
				}
				#mild
				60 = {
					random_list = {
						4 = { scope:betrothed_1 = { add_trait = depressed_1 } }
						1 = { scope:betrothed_1 = { add_trait = drunkard } }
						1 = { scope:betrothed_1 = { add_trait = reclusive } }
						1 = { scope:betrothed_1 = { add_trait = irritable } }
						1 = { scope:betrothed_1 = { add_trait = hashishiyah } }
					}
				}
				#moderate
				20 = {
					random_list = {
						50 = {
							trigger_event =  agot_engagement_events.0008
						}
						50 = {
							scope:betrothed_1 = {
								set_variable = {
									name = unfruitful_marriage
									value = scope:betrothed_2
								}
							}
						}
						50 = {
							scope:betrothed_1 = {
								set_relation_rival = { reason = rival_forced_betrothal target = scope:betrothed_2 }
							}
						}
					}
				}
				#extreme
				5 = {
					modifier = {
						scope:betrothed_1 = { has_trait = stubborn }
						add = 20
					}
					modifier = {
						scope:betrothed_1 = { has_trait = brave }
						add = 10
					}
					modifier = {
						scope:betrothed_1 = { has_trait = eccentric }
						add = 10
					}
					random_list = {
						200 = {
							trigger = {
								exists = scope:betrothed_lover
							}
							scope:betrothed_1 = {
								add_character_flag = can_disinherit
								save_scope_as = target
							}
							scope:betrothed_2 = {
								trigger_event = {
									id = elope.1001
									days = 7
								}
							}
						}
						#leave court
						50 = {
							trigger = {
								NOT = { exists = scope:betrothed_lover }
							}
							trigger_event = {
								id = agot_engagement_events.0003
								days = { 3 7 }
							}
						}
						#nw
						70 = {
							trigger = {
								NOT = { exists = scope:betrothed_lover }
								scope:betrothed_1 = {
									ai_honor > medium_positive_honor
									prowess > 15
									NOT = { has_trait = lustful }
									is_male = yes
									location = { geographical_region = world_westeros_seven_kingdoms }
								}
							}
							modifier = {
								add = scope:betrothed_1.ai_honor
							}
							modifier = {
								scope:betrothed_1.culture = { has_cultural_pillar = heritage_first_man }
								factor = 2
							}
							trigger_event = {
								id = agot_engagement_events.0004
								days = { 3 7 }
							}
						}
						#maester
						70 = {
							trigger = {
								NOT = { exists = scope:betrothed_lover }
								scope:betrothed_1 = {
									learning > 10
									NOT = { has_trait = lustful }
									culture = { has_innovation = innovation_maesters }
									is_male = yes
								}
							}
							modifier = {
								add = scope:betrothed_1.ai_rationality
							}
							modifier = {
								scope:betrothed_1 = { has_trait = intellect_good_1 }
								factor = 2
							}
							modifier = {
								scope:betrothed_1 = { has_trait = intellect_good_2 }
								factor = 2
							}
							modifier = {
								scope:betrothed_1 = { has_trait = intellect_good_3 }
								factor = 2
							}
							modifier = {
								scope:betrothed_1 = { has_trait = shrewd }
								factor = 2
							}
							modifier = {
								scope:betrothed_1 = { has_trait = inquisitive }
								factor = 2
							}
							trigger_event = {
								id = agot_engagement_events.0005
								days = { 3 7 }
							}
						}
						#septon
						70 = {
							trigger = {
								scope:betrothed_1 = {
									religion = religion:faith_of_the_seven_religion
									faith = {
										has_doctrine = doctrine_clerical_marriage_disallowed
									}
									ai_zeal >= medium_positive_zeal
									NOT = { has_trait = lustful }
								}
								NOT = { exists = scope:betrothed_lover }
							}
							modifier = {
								add = scope:betrothed_1.ai_zeal
							}
							modifier = {
								scope:betrothed_1 = { has_trait = zealous }
								factor = 2
							}
							modifier = {
								scope:betrothed_1 = { has_trait = humble }
								factor = 2
							}
							trigger_event = {
								id = agot_engagement_events.0006
								days = { 3 7 }
							}
						}
						#red priest
						70 = {
							trigger = {
								scope:betrothed_1 = {
									religion = religion:rhllor_religion
									faith = {
										has_doctrine = doctrine_clerical_marriage_disallowed
									}
									ai_zeal >= medium_positive_zeal
									NOT = { has_trait = lustful }
								}
								NOT = { exists = scope:betrothed_lover }
							}
							modifier = {
								add = scope:betrothed_1.ai_zeal
							}
							modifier = {
								scope:betrothed_1 = { has_trait = zealous }
								factor = 2
							}
							modifier = {
								scope:betrothed_1 = { has_trait = humble }
								factor = 2
							}
							trigger_event = {
								id = agot_engagement_events.0009
								days = { 3 7 }
							}
						}
						#death
						10 = {
							trigger_event = {
								id = agot_engagement_events.0007
								days = 1
							}
						}
					}
				}
			}
			scope:betrothed_1 = {
				set_variable = {
					name = unhappy_with_fiance
					value = scope:betrothed_2
				}
			}
		}
	}

	#Break the engagement
	option = {
		name = agot_engagement_events.0002.b
		custom_tooltip = agot_engagement_events.0002.b.tt
		scope:betrothed_1 = {
			if = {
				limit = {
					has_been_promised_grand_wedding = yes
				}
				break_grand_wedding_betrothal_effect = yes
			}
			else = {
				break_betrothal = betrothed
			}
		}
		scope:betrothed_1 = {
			set_variable = {
				name = ended_engagement
				value = scope:betrothed_2
			}
		}
		scope:betrothed_2 = {
			set_variable = {
				name = ended_engagement
				value = scope:betrothed_1
			}
		}
	}

	#You may choose your own marriage
	option = {
		trigger = {
			scope:betrothed_lover ?= {
				could_marry_character_trigger = { CHARACTER = scope:betrothed_1 }
				can_marry_trigger = yes
				NOT = {
					any_heir_title = {}
					any_pretender_title = {
						place_in_line_of_succession = {
							target = prev
							value <= 2
						}
					}
				}
			}
		}
		scope:betrothed_1 = {
			if = {
				limit = {
					is_female = yes
					is_lowborn = no
					scope:spouse = {
						is_lowborn = yes
					}
				}
				marry_matrilineal = scope:betrothed_lover
			}
			else_if = {
				limit = {
					is_male = yes
					is_lowborn = yes
					scope:spouse = {
						is_lowborn = no
					}
				}
				marry_matrilineal = scope:betrothed_lover
			}
			else = {
				marry = scope:betrothed_lover
			}
		}
		name = agot_engagement_events.0002.c
	}
}

#Child leaves court and disowns self
agot_engagement_events.0003 = {
	type = letter_event
	opening = agot_engagement_events.0003.opening
	desc = agot_engagement_events.0003.desc
	sender = scope:betrothed_1

	immediate = {
		hidden_effect = {
			random_ruler = {
				limit = {
					is_landed = yes
					in_diplomatic_range = root
					NOT = {
						culture = { agot_is_wildling_culture = yes }
					}
					NOT = { is_vassal_or_below_of = root }
				}
				capital_province = {
					save_scope_as = somewhere_else
				}
			}
			if = {
				limit = {
					NOT = { exists = scope:somewhere_else }
				}
				random_ruler = {
					limit = {
						is_landed = yes
						in_diplomatic_range = root
						NOT = {
							culture = { agot_is_wildling_culture = yes }
						}
					}
					capital_province = {
						save_scope_as = somewhere_else
					}
				}
			}
			scope:betrothed_1= {
				move_to_pool_at = scope:somewhere_else
				set_variable = {
					name = forced_engagement
					value = root
				}
			}
		}
		scope:betrothed_1= {
			break_betrothal = betrothed
			add_trait = disinherited
		}

	}

	option = {
		name = agot_engagement_events.0003.a
	}
}

#Child joins NW
agot_engagement_events.0004 = {
	type = letter_event
	opening = agot_engagement_events.0004.opening
	desc = agot_engagement_events.0004.desc
	sender = scope:betrothed_1

	immediate = {
		scope:betrothed_1 = { agot_add_to_nightswatch_effect = yes }
	}

	option = {
		name = agot_engagement_events.0004.a
	}
}

#Child becomes maester
agot_engagement_events.0005 = {
	type = letter_event
	opening = agot_engagement_events.0005.opening
	desc = agot_engagement_events.0005.desc
	sender = scope:betrothed_1

	immediate = {
		agot_send_to_citadel_effect = { MAESTER_CANDIDATE = scope:betrothed_1 }
	}

	option = {
		name = agot_engagement_events.0005.a
	}
}


#Child becomes septon
agot_engagement_events.0006 = {
	type = letter_event
	opening = agot_engagement_events.0006.opening
	desc = agot_engagement_events.0006.desc
	sender = scope:betrothed_1

	immediate = {
		scope:betrothed_1 = {
			save_scope_as = recipient #Required for scripted_effect
			send_child_to_clergy_effect = yes
		}
	}

	option = {
		name = agot_engagement_events.0006.a
	}
}

#Child dies
agot_engagement_events.0007 = {
	type = character_event
	title = agot_engagement_events.0007.t
	desc = agot_engagement_events.0007.desc

	theme = death

	right_portrait = {
		character = root
		animation = grief
	}

	lower_left_portrait = {
		character = scope:betrothed_1
	}

	immediate = {
		scope:betrothed_1 = {
			death = { death_reason = death_horse_riding_accident }
		}
	}

	option = {
		name = agot_engagement_events.0007.a
	}
}

#Refusing Marriage
agot_engagement_events.0008 = {
	type = character_event
	title = agot_engagement_events.0008.t
	desc = agot_engagement_events.0008.desc

	theme = family

	left_portrait = {
		character = root
		animation = disapproval
	}

	right_portrait = {
		character = scope:betrothed_1
		animation = anger
	}

	immediate = {
		scope:betrothed_1 = {
			if = {
				limit = {
					has_been_promised_grand_wedding = yes
				}
				break_grand_wedding_betrothal_effect = yes
			}
			else = {
				break_betrothal = betrothed
			}
			add_trait = refusing_marriage
			add_character_flag = can_disinherit
		}
	}

	option = {
		name = agot_engagement_events.0008.a
	}

	option = {
		name = agot_engagement_events.0008.b
		imprison_character_effect = {
			TARGET = scope:betrothed_1
			IMPRISONER = root
		}
	}

	option = {
		name = agot_engagement_events.0008.c
		scope:betrothed_1 = {
			add_trait = disinherited
			agot_banish_effect = { BANISHER = root }
		}
	}
}

#Child becomes red priest
agot_engagement_events.0009 = {
	type = letter_event
	opening = agot_engagement_events.0009.opening
	desc = agot_engagement_events.0009.desc
	sender = scope:betrothed_1

	immediate = {
		scope:betrothed_1 = {
			save_scope_as = recipient #Required for scripted_effect
			send_child_to_clergy_effect = yes
		}
	}

	option = {
		name = agot_engagement_events.0009.a
	}
}