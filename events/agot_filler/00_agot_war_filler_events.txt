namespace = agot_filler_war

##########################################
# Down the Slopes of Death
##########################################

agot_filler_war.200 = { # War! The battle grows weary on our side... As losses pile up, darkness reigns the crumbling sky, and carnage has begun.
	type = character_event
	title = agot_filler_war.200.t
	desc = agot_filler_war.200.desc
	theme = war
	override_background = {
		reference = battlefield
	}

	left_portrait = {
		character = root
		triggered_animation = {
			trigger = {
				has_trait = craven
			}
			animation = fear
		}
	}

	trigger = {
		location = {
			geographical_region = world_westeros
		}
		is_available_adult = yes
		is_at_war = yes
		is_commanding_army = yes
		any_heir = {
			count= all
			exists = no
		}
		NOT = {
			has_character_flag = down_the_slopes_of_death
		}
		root.commanding_army = {
			is_army_in_combat = yes
		}
	}

	immediate = {
		add_character_flag = down_the_slopes_of_death
		random_list = {
			50 = {
				desc = agot_filler_war.200.list_1 # I am the last of my line.. If I should fall, let it be worthy of remembrance, upon my loyal steed and my lance gripped firm in my hand.
				modifier = {
					add = {
						value = 1
						if = {
							limit = {
								OR = {
									has_trait = brave
									has_trait = depressed_1
									has_trait = ambitious
								}
							}
							add = 100
						}
					}
				}
			}
			50 = {
				desc = agot_filler_war.200.list_2 # I can't hold myself together any longer, I have not a warrior's soul.
				modifier = {
					add = {
						value = 1
						if = {
							limit = {
								has_trait = craven
							}
							add = 100
						}
					}
				}
			}
		}
	}

	option = {	# They shall sing songs about my deeds...
		name = agot_filler_war.200.a
		custom_tooltip = agot_filler_war.200.a_tt
		trigger = {
			NOT = {
				has_trait = craven
			}
		}
		trigger_event = agot_filler_war.201
	}

	option = {	# Chaos reigns around me...
		name = agot_filler_war.200.b
		custom_tooltip = agot_filler_war.200.b_tt
		trigger = {
			has_trait = craven
		}
	}
}

##########################################
# Down the Slopes of Death - reminiscence
##########################################

agot_filler_war.201 = { # Fields of flames greets my eye, as my knights' horns sound the charge.. I smell the fear and pain of dying men in agony, friend and foe. It could drive a man insane. But on the field waits my fate, foretold from ancient times... in a clear hill it awaits, a beast with sharp iron teeth and hateful burning eyes.
	type = character_event
	title = agot_filler_war.201.t
	desc = agot_filler_war.201.desc
	theme = war
	override_background = {
	  reference = battlefield
	}

	left_portrait = {
		character = root
		animation = war_defender
	}

	right_portrait = {
		character = scope:beast_dtsod
		animation = personality_bold
	}

	immediate = {
		create_character = {
			save_scope_as = beast_dtsod
			age = { 20 50 }
			gender = male
			gender_female_chance = 20
			trait = knight
			random_traits = no
			location = root.location
			faith = root.faith
			culture = root.culture
			dynasty = none
			prowess = root.prowess
		}
	}

	option = {	# I know now what is to come. It's no use, to try and run... What is to be..
		name = agot_filler_war.201.a
		custom_tooltip = agot_filler_war.201.a_tt # let it be done. May I draw my final breath, the last of my kin...
		configure_start_single_combat_effect = { #AGOT TODO
			SC_INITIATOR = root
			SC_ATTACKER = root
			SC_DEFENDER = scope:beast_dtsod
			FATALITY = always
			FIXED = no
			LOCALE = terrain_scope
			OUTPUT_EVENT = agot_filler_war.202
			INVALIDATION_EVENT = single_combat.1006
		}
	}
}

##########################################
# Down the Slopes of Death - victory
##########################################

agot_filler_war.202 = { # What is to be, let it be done! My opponent lies dead at my feet. As my sight pans over the battlefield, I see the enemy has started to rout in their flank. My actions won the day, and songs will be sung of how the last $house name$ led his men in a fearless charge to victory.
	type = character_event
	title = agot_filler_war.202.t
	desc = agot_filler_war.202.desc
	theme = war
	override_background = {
	  reference = battlefield
	}

	left_portrait = {
		character = root
		animation = war_over_win
	}

	immediate = {
		add_prestige_level = 1
	}

	trigger = {

	}

	option = {	# Seek out a bard troupe for me. Let them spread word of my heroics today.
		name = agot_filler_war.202.a
		custom_tooltip = agot_filler_war.202.a_tt
		trigger = {
			has_trait = arrogant
			gold >= 100
		}
		trigger_event = agot_filler_war.203
	}

	option = {	# It really is something... to see my men look up to me like this.
		name = agot_filler_war.202.b
		custom_tooltip = agot_filler_war.202.b_tt
		add_trait = aggressive_attacker
	}
}

##########################################
# Down the Slopes of Death - bard
##########################################

agot_filler_war.203 = { # The leader of the bard troupe I hired has returned, tales of my deeds are sung from Bear Island to the Stepstones and beyond.
	type = character_event
	title = agot_filler_war.203.t
	desc = agot_filler_war.203.desc
	theme = martial_chivalry_focus
	override_background = {
	  reference = throne_room_west
	}

	left_portrait = {
		character = root
		animation = war_over_win
	}

	right_portrait = {
		character = cp:councillor_chancellor
		animation = ecstasy
	}

	option = {	# And may many more of them be written.
		name = agot_filler_war.203.a
		add_prestige_level = 1
	}

	option = {	# One is enough, I guess.
		name = agot_filler_war.203.b
		custom_tooltip = agot_filler_war.203.b_tt
		trigger = {
			OR = {
				has_trait = content
				has_trait = humble
			}
		}
		add_prestige_level = 1
	}
}

##########################################
# The Folly of Broken Men
##########################################

agot_filler_war.300 = { # On the wake of the battle's end, some of my men desecrated a nearby village. There's nothing to do for the poor inhabitants - my men were shaken and disturbed by war, and cared not for the lives of the peasants. At least they were put to the sword, in the end. Saved them from a lifetime of dwelling on past horrors.
	type = character_event
	title = agot_filler_war.300.t
	desc = agot_filler_war.300.desc
	theme = war
	# override_background = {
	# 	reference = AGOT TODO - burning village background
	# }

	left_portrait = {
		character = root
		animation = shock
		triggered_animation = {
			trigger = {
				OR = {
					has_trait = sadistic
					has_trait = callous
				}
			}
			animation = dismissal
		}
	}

	right_portrait = {
		character = cp:councillor_marshal
		triggered_animation = {
			trigger = {
				cp:councillor_marshal = {
					OR = {
						has_trait = sadistic
						has_trait = callous
					}
				}
			}
			animation = dismissal
		}
		triggered_animation = {
			trigger = {
				cp:councillor_marshal = {
					NOR = {
						has_trait = sadistic
						has_trait = callous
					}
				}
			}
			animation = shock
		}
	}

	trigger = {
		location = {
			geographical_region = world_westeros
		}
		is_available_adult = yes
		is_at_war = yes
		is_commanding_army = yes
		NOT = {
			has_character_flag = broken_men_event
		}
		root.commanding_army = {
			is_army_in_combat = no
		}
	}

	immediate = {
		add_character_flag = broken_men_event
	}

	option = {	# Hang those who raped and pillaged - we are all prisoners to war's hell, it does not give us license to act like common bandits.
		name = agot_filler_war.300.a
		custom_tooltip = agot_filler_war.300.a_tt
		trigger = {
			has_trait = just
			NOT = { has_trait = callous }
		}
		add_prestige = 25
		add_martial_lifestyle_perk_points = 1
	}

	option = {	# We can't throw men's lives away like this, despite their actions. Throw them back in line, discipline them.
		name = agot_filler_war.300.b
		custom_tooltip = agot_filler_war.300.b_tt
		trigger = {
			NOR = {
				has_trait = just
				has_trait = compassionate
			}
		}
		add_character_modifier = {
			modifier = let_soldiers_pillage_modifier
			years = 5
		}
	}
}

##########################################
# The Hanged Man
##########################################

agot_filler_war.400 = { #
	type = character_event
	title = agot_filler_war.400.t
	desc = agot_filler_war.400.desc
	theme = war
	override_background = {
		reference = burning_building
	}


	left_portrait = {
		character = root
		animation = disbelief
		triggered_animation = {
			trigger = {
				OR = {
					has_trait = sadistic
					has_trait = callous
				}
			}
			animation = dismissal
		}
	}

	right_portrait = {
		character = scope:soldier
	}

	lower_center_portrait = {
		character = scope:hanged_baby
	}

	trigger = {
		location = {
			geographical_region = world_westeros_the_riverlands
		}
		is_at_war = yes
		is_commanding_army = yes
		NOT = {
			exists = global_var:baby_guts
		}
		root.commanding_army = {
			is_army_in_combat = no
		}
	}

	immediate = {
		set_global_variable = {
			name = baby_guts
			value = yes
			days = 10000
		}

		create_character = {
			age = 0
			dynasty = none
			location = this.location
			faith = root.faith
			culture = root.culture
			gender_female_chance = root_soldier_female_chance
			save_scope_as = hanged_baby
			trait = strong
			trait = physique_good_2
		}

		if = {
			limit = {
				any_courtier = {
					location = root.location
					is_available_adult = yes
					is_knight_of = root
					ai_compassion < 0 #cool killing the baby
				}
			}
			random_courtier = {
				limit = {
					is_available_adult = yes
					is_knight_of = root
					ai_compassion < 0 #cool killing the baby
				}
				save_scope_as = soldier
			}
		}
		else = {
			create_character = {
				template = new_commander_character
				dynasty = none
				employer = root
				gender = male
				faith = root.faith
				culture = root.culture
				save_scope_as = soldier
			}
			scope:soldier = {
				if = {
					limit = {
						has_trait = compassionate
					}
					remove_trait = compassionate
				}
				if = {
					limit = {
						NOT = { has_trait = sadistic }
					}
					add_trait = callous
				}
			}

		}
	}

	option = {
		name = agot_filler_war.400.a

		add_prestige = minor_prestige_loss

		add_courtier ?= scope:hanged_baby

		ai_chance = {
			base = 40
		}
	}

	option = {
		name = agot_filler_war.400.b

		trigger = {
			is_male = yes
			NOT = {
				has_trait = chaste
				has_trait = celibate
				has_trait = eunuch
			}
		}
		add_courtier ?= scope:hanged_baby
		scope:hanged_baby = {
			set_house = root.house
			add_trait = bastard
			give_nickname = nick_rivers
			set_father = root
		}
		stress_impact = {
			compassionate = massive_stress_impact_loss
			paranoid = medium_stress_impact_gain
			callous = major_stress_impact_gain
			sadistic = major_stress_impact_gain
		}

		ai_chance = {
			base = 20
			modifier = {
				factor = 0
				OR = {
					has_trait = paranoid
					has_trait = arrogant
					has_trait = callous
					has_trait = sadistic
					ai_honor >= high_positive_honor #Won't sully their honor taking a random bastard
				}
			}
		}
	}

	option = {
		name = agot_filler_war.400.c
		scope:hanged_baby = {
			death = {
				death_reason = death_disappearance
			}
		}
		add_piety = major_piety_gain

		ai_chance = {
			base = 40
			modifier = { #Nice peoples don't let babies die
				factor = 0
				ai_compassion >= 20
			}
		}
	}

}
